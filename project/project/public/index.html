<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
	</head>
	<link rel="stylesheet" href="css/index.css">
	<script src="js/index.js"></script>
	<body>
		<h1>添加数据</h1>
		姓名：<input type="text">
		年龄：<input type="text">
		性别：<input type="text">
		<button>提交</button>
		
		<h1>获取数据</h1>
		<table>
			<thead>
				<tr>
					<th>姓名</th>
					<th>年龄</th>
					<th>性别</th>
					<th>操作</th>
				</tr>
			</thead>
			<tbody id="tb">
				
			</tbody>
		</table>
		<script src="jquery-3.6.1.js"></script>
		<script>
			
			studelete();
			
			function studelete(){
				$.ajax({
					url:"/index/get",
					type:"get",
					success:function({msg,status,data}){
						let str=data.map(item=>`
						<tr>
							<td>${item.name}</td>
							<td>${item.age}</td>
							<td>${item.gender}</td>
							<td>
								<button class="editbtn">修改</button>
								<button class="deletebtn" data-stuid="${item._id}">删除</button>
							</td>
						</tr>
						`);
						$("tbody").html(str);
						//console.log(str);
						/* msg.data.forEach(function(item){
							$("tbody").append(`
							<tr>
								<td>${item.name}</td>
								<td>${item.age}</td>
								<td>${item.gender}</td>
								<td>
									<button>修改</button>
									<button>删除</button>
								</td>
							</tr>`
							);
						})	 */
					}
				})
			}
			
			//事件委托，将动态生成标签的事件绑定在父标签上，父标签为静态标签
			$("tbody").on("click",".deletebtn",function(){
				const _id= $(this).data("stuid");//原生js this表示绑定元素，而jquery中this表示事件元素
				console.log(_id);
				$.ajax({
					url:"/index/delete",
					data:{
						_id
					},
					type:"post",
					success(msg){
						if(msg.status){
							alert("删除成功");
							studelete();
						};
					}
				})
			})
		</script>
	</body>
</html>